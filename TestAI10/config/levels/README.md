# 关卡配置文件说明

## 文件格式
所有关卡配置文件使用JSON格式，存储在 `config/levels/` 目录下。

## 配置文件命名规则
- 格式：`level{关卡编号}.json`
- 示例：`level1.json`, `level2.json`, `level3.json`

## 配置数据结构

### 根对象字段
- `levelId` (number, 必需): 关卡编号，从1开始
- `matrix` (object, 必需): 矩阵大小配置
- `escapePoints` (array, 必需): 逃脱点位置数组
- `worms` (array, 必需): 蠕虫配置数组

### matrix 对象
- `width` (number): 矩阵宽度（格子数）
- `height` (number): 矩阵高度（格子数）

### escapePoints 数组元素
- `x` (number): 逃脱点X坐标（矩阵边界，0到width-1或0到height-1）
- `y` (number): 逃脱点Y坐标

### worms 数组元素
- `id` (number): 蠕虫唯一标识
- `segments` (array): 蠕虫身体段坐标数组
  - 第一个元素为头部位置
  - 最后一个元素为尾部位置
  - 中间元素为身体段位置
- `direction` (string, 必需): 蠕虫朝向，表示蠕虫头部面向的方向（蠕虫只能沿此方向移动）
  - `"up"`: 向上（头部朝上，只能向上移动）
  - `"down"`: 向下（头部朝下，只能向下移动）
  - `"left"`: 向左（头部朝左，只能向左移动）
  - `"right"`: 向右（头部朝右，只能向右移动）
  
  **注意**：
  - direction 表示蠕虫的移动方向，即头部面向的方向
  - segments 数组的第一个元素是头部位置，最后一个元素是尾部位置
  - 如果配置的 direction 与 segments 的实际排列方向不一致，系统会给出警告但仍使用配置的 direction
  - 建议确保 direction 与 segments 的排列方向一致，以避免混淆
- `color` (string): 蠕虫颜色，使用十六进制颜色码（如 `"#FF5733"`）

## 坐标系统
- 坐标原点 (0, 0) 位于矩阵左上角
- X轴向右递增
- Y轴向下递增
- 所有坐标必须在矩阵范围内：`0 <= x < width`, `0 <= y < height`

## 逃脱点规则
- 逃脱点必须位于矩阵边界上
- 对于水平边界：`x = 0` 或 `x = width - 1`
- 对于垂直边界：`y = 0` 或 `y = height - 1`

## 蠕虫配置规则
1. 蠕虫的segments数组必须至少包含2个元素（头部和尾部）
2. segments中的坐标必须连续（相邻段必须相邻）
3. **direction 字段是必需的**，表示蠕虫头部面向的方向（移动方向）
   - direction 与 segments 的排列方向应该一致
   - segments[0] 是头部，segments[1] 是第一个身体段
   - 如果 segments 从 (0,0) 到 (1,0)，表示身体向右延伸，那么头部应该朝左（left），因为蠕虫只能朝头部方向移动
   - 如果 segments 从 (0,0) 到 (0,1)，表示身体向下延伸，那么头部应该朝上（up）
4. 不同蠕虫的segments不能重叠
5. 蠕虫不能超出矩阵范围

## direction 配置示例

### 示例1：水平蠕虫，向右移动
```json
{
  "segments": [
    {"x": 0, "y": 0},  // 头部
    {"x": 1, "y": 0},  // 身体段1
    {"x": 2, "y": 0}   // 身体段2（尾部）
  ],
  "direction": "right"  // 头部朝右，向右移动
}
```

### 示例2：水平蠕虫，向左移动
```json
{
  "segments": [
    {"x": 2, "y": 0},  // 头部
    {"x": 1, "y": 0},  // 身体段1
    {"x": 0, "y": 0}   // 身体段2（尾部）
  ],
  "direction": "left"   // 头部朝左，向左移动
}
```

### 示例3：垂直蠕虫，向下移动
```json
{
  "segments": [
    {"x": 0, "y": 0},  // 头部
    {"x": 0, "y": 1},  // 身体段1
    {"x": 0, "y": 2}   // 身体段2（尾部）
  ],
  "direction": "down"   // 头部朝下，向下移动
}
```

### 示例4：垂直蠕虫，向上移动
```json
{
  "segments": [
    {"x": 0, "y": 2},  // 头部
    {"x": 0, "y": 1},  // 身体段1
    {"x": 0, "y": 0}   // 身体段2（尾部）
  ],
  "direction": "up"     // 头部朝上，向上移动
}
```

## 示例文件
- `level1.json`: 简单关卡，3条蠕虫，10x10矩阵
- `level2.json`: 中等难度，5条蠕虫，12x12矩阵
- `level3.json`: 困难关卡，7条蠕虫，15x15矩阵

## 验证
在加载关卡配置时，应该验证：
1. JSON格式正确性
2. 必需字段存在
3. 坐标范围有效性
4. 蠕虫segments连续性
5. 蠕虫之间无重叠
6. 逃脱点位置有效性

