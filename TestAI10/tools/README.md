# 关卡编辑器使用说明

## 概述

关卡编辑器是一个独立的HTML工具，用于可视化创建和编辑游戏关卡配置。

## 使用方法

1. 直接在浏览器中打开 `level-editor.html` 文件
2. 使用左侧控制面板配置关卡
3. 在右侧画布上可视化编辑蠕虫位置
4. 保存为JSON文件到 `config/levels/` 目录

## 功能说明

### 1. 关卡大小配置

- **宽度**：设置矩阵的宽度（3-20）
- **高度**：设置矩阵的高度（3-20）
- 修改后会自动更新可视化网格

### 2. 编辑模式

- **点击模式**：点击网格逐个添加蠕虫身体段
  - 新段必须与最后一个段相邻（水平或垂直）
  - 适合精确放置
  
- **拖拽模式**：拖拽鼠标绘制蠕虫路径
  - 自动连接相邻的格子
  - 适合快速绘制长蠕虫

### 3. 蠕虫管理

- **添加蠕虫**：点击"添加蠕虫"按钮创建新蠕虫
- **选择蠕虫**：在蠕虫列表中点击选择当前编辑的蠕虫
- **删除蠕虫**：点击蠕虫列表中的"删除"按钮或使用"删除当前蠕虫"按钮

### 4. 蠕虫属性编辑

选中蠕虫后可以修改：
- **颜色**：使用颜色选择器或输入十六进制颜色码（如 #FF5733）
- **方向**：选择蠕虫头部朝向（up/down/left/right）

### 5. 文件操作

- **加载关卡**：从JSON文件加载现有关卡配置
- **保存关卡**：将当前配置保存为JSON文件（文件名：`level{关卡ID}.json`）
- **导出JSON**：将JSON内容复制到剪贴板，方便手动保存

## 操作流程

1. 设置关卡大小（宽度和高度）
2. 选择编辑模式（点击或拖拽）
3. 点击"添加蠕虫"创建新蠕虫
4. 在画布上添加蠕虫段：
   - 点击模式：逐个点击格子
   - 拖拽模式：按住鼠标拖拽绘制路径
5. 调整蠕虫属性（颜色、方向）
6. 添加更多蠕虫（重复步骤3-5）
7. 设置关卡ID
8. 点击"保存关卡"保存JSON文件
9. 将保存的文件放到 `config/levels/` 目录

## 注意事项

1. **蠕虫段连续性**：每个新段必须与前一个段相邻（不能跳过格子）
2. **位置占用**：不同蠕虫的段不能重叠
3. **坐标范围**：所有蠕虫段必须在矩阵范围内（0 到 width-1，0 到 height-1）
4. **最少段数**：每个蠕虫至少需要2个段（头部和尾部）
5. **数据验证**：保存时会自动验证数据，如有错误会提示

## 技术说明

- 坐标系统与游戏一致：原点在左上角，X向右递增，Y向下递增
- 蠕虫的第一个段是头部（带眼睛标记）
- 头部眼睛位置根据蠕虫方向显示
- 当前选中的蠕虫会显示蓝色边框高亮

## 文件格式

保存的JSON文件格式与游戏配置格式完全一致：

```json
{
  "levelId": 1,
  "matrix": {
    "width": 8,
    "height": 8
  },
  "escapePoints": [],
  "worms": [
    {
      "id": 1,
      "segments": [
        {"x": 0, "y": 0},
        {"x": 1, "y": 0}
      ],
      "direction": "right",
      "color": "#FF5733"
    }
  ]
}
```

注意：`escapePoints`（逃脱点）字段在编辑器中会自动生成。保存关卡时，如果 `escapePoints` 为空，编辑器会自动根据矩阵大小生成默认的逃脱点（在四个边的中间位置）。如果需要自定义逃脱点，可以手动编辑JSON文件。
