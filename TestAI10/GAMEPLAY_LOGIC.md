# 游戏核心玩法逻辑说明

## 核心玩法流程

### 1. 玩家操作
- **触发**：点击蠕虫身体的任意部位
- **响应**：系统判断该蠕虫是否可以逃脱

### 2. 逃脱判定逻辑

#### 2.1 可逃脱情况
**条件**：从蠕虫头部位置，沿着头部方向（direction），到矩阵边界存在**完全无障碍**的路径

**行为**：
1. 蠕虫自动沿着该路径移动（一格一格）
2. 每移动一格播放移动动画和音效
3. 到达矩阵边界后，蠕虫消失并播放逃脱特效
4. 检查是否所有蠕虫都已逃脱（胜利判定）

#### 2.2 不可逃脱情况
**条件**：从蠕虫头部位置，沿着头部方向，下一步就会撞到其他蠕虫的身体部位

**行为**：
1. 蠕虫执行**一次移动尝试**（向前移动一步）
2. 检测到碰撞后：
   - 播放碰撞音效
   - 蠕虫高亮警示（红色闪烁动画）
   - 警示动画完成后，蠕虫**后退复位到原始位置**
   - 消耗一次失败机会（失败次数-1）
3. 如果失败次数归零，游戏失败

### 3. 关键规则

#### 3.1 蠕虫移动规则
- **只能向前**：蠕虫只能沿着头部方向（direction）向前移动
- **不能拐弯**：蠕虫不能改变方向，只能直线前进
- **一格一格移动**：每次移动只移动一格

#### 3.2 碰撞检测规则
- **碰撞对象**：其他蠕虫的**身体部位**（不包括头部）
- **碰撞判定**：蠕虫头部移动后的新位置与其他蠕虫身体段重叠
- **碰撞结果**：高亮警示 → 后退复位 → 失败次数-1

#### 3.3 失败机制
- 每关初始有**3次失败机会**（显示为3个红心）
- 每次碰撞消耗1次失败机会
- 失败次数归零时，游戏失败

#### 3.4 胜利条件
- 所有蠕虫成功逃离矩阵
- 显示胜利动画和粒子特效

## 实现要点

### 路径查找
- 只检查从头部位置沿着头部方向到边界的直线路径
- 如果路径上有任何障碍物（其他蠕虫身体），返回null（不可逃脱）
- 如果路径无障碍，返回完整路径数组

### 移动处理
- **可逃脱**：按路径数组逐步移动，每步等待动画完成
- **不可逃脱**：只移动一步，检测碰撞，如果碰撞则复位

### 碰撞处理
- 在移动前预测是否会碰撞
- 如果预测到碰撞，执行移动 → 高亮警示 → 复位流程
- 如果预测不到碰撞，正常移动（但这种情况应该不会发生，因为已经判定为"不可逃脱"）

