{"version":3,"sources":["file:///G:/escapeworm/NewProject/assets/scripts/managers/EffectManager.ts"],"names":["_decorator","Component","Color","Graphics","ccclass","property","EffectManager","particles","graphics","onLoad","getComponent","addComponent","createEscapeEffect","position","color","particleCount","i","angle","Math","PI","speed","random","push","x","y","vx","cos","vy","sin","life","decay","size","createVictoryEffect","center","colors","floor","length","createHighlightAnimation","targetNode","callback","Promise","resolve","flashCount","maxFlashes","flashInterval","flash","isHighlighted","getChildByName","setScale","setTimeout","update","dt","clear","particle","splice","drawParticle","hexToColor","fillColor","circle","fill","hex","alpha","result","exec","parseInt"],"mappings":"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","sourcesContent":["/**\r\n * 特效管理器\r\n * 管理粒子特效和动画效果\r\n */\r\nimport { _decorator, Component, Node, Vec3, Color, Graphics, UITransform, tween } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\ninterface Particle {\r\n    x: number;\r\n    y: number;\r\n    vx: number;\r\n    vy: number;\r\n    color: string;\r\n    life: number;\r\n    decay: number;\r\n    size: number;\r\n}\r\n\r\n@ccclass('EffectManager')\r\nexport class EffectManager extends Component {\r\n    private particles: Particle[] = [];\r\n    private graphics: Graphics | null = null;\r\n\r\n    protected onLoad() {\r\n        // 创建 Graphics 组件用于绘制粒子\r\n        this.graphics = this.getComponent(Graphics) || this.addComponent(Graphics);\r\n    }\r\n\r\n    /**\r\n     * 创建逃脱粒子特效\r\n     */\r\n    public createEscapeEffect(position: Vec3, color: string) {\r\n        const particleCount = 20;\r\n        for (let i = 0; i < particleCount; i++) {\r\n            const angle = (Math.PI * 2 * i) / particleCount;\r\n            const speed = 2 + Math.random() * 3;\r\n            this.particles.push({\r\n                x: position.x,\r\n                y: position.y,\r\n                vx: Math.cos(angle) * speed,\r\n                vy: Math.sin(angle) * speed,\r\n                color: color,\r\n                life: 1.0,\r\n                decay: 0.02 + Math.random() * 0.02,\r\n                size: 3 + Math.random() * 3\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 创建胜利粒子特效\r\n     */\r\n    public createVictoryEffect(center: Vec3) {\r\n        const particleCount = 50;\r\n        const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#95E1D3', '#F38181'];\r\n        for (let i = 0; i < particleCount; i++) {\r\n            const angle = (Math.PI * 2 * i) / particleCount;\r\n            const speed = 3 + Math.random() * 4;\r\n            this.particles.push({\r\n                x: center.x,\r\n                y: center.y,\r\n                vx: Math.cos(angle) * speed,\r\n                vy: Math.sin(angle) * speed,\r\n                color: colors[Math.floor(Math.random() * colors.length)],\r\n                life: 1.0,\r\n                decay: 0.015 + Math.random() * 0.01,\r\n                size: 4 + Math.random() * 4\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 创建高亮警示动画\r\n     */\r\n    public createHighlightAnimation(targetNode: Node, callback?: () => void): Promise<void> {\r\n        return new Promise((resolve) => {\r\n            let flashCount = 0;\r\n            const maxFlashes = 6;\r\n            const flashInterval = 100;\r\n\r\n            const flash = () => {\r\n                const isHighlighted = flashCount % 2 === 0;\r\n                // 通过改变节点透明度实现闪烁\r\n                targetNode.getChildByName('HighlightOverlay')?.setScale(isHighlighted ? 1 : 0, 1, 1);\r\n                flashCount++;\r\n\r\n                if (flashCount < maxFlashes) {\r\n                    setTimeout(flash, flashInterval);\r\n                } else {\r\n                    if (callback) callback();\r\n                    resolve();\r\n                }\r\n            };\r\n\r\n            flash();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 更新所有粒子\r\n     */\r\n    protected update(dt: number) {\r\n        if (!this.graphics) return;\r\n\r\n        // 清空之前的绘制\r\n        this.graphics.clear();\r\n\r\n        // 更新并绘制粒子\r\n        for (let i = this.particles.length - 1; i >= 0; i--) {\r\n            const particle = this.particles[i];\r\n\r\n            // 更新位置\r\n            particle.x += particle.vx;\r\n            particle.y += particle.vy;\r\n\r\n            // 更新生命周期\r\n            particle.life -= particle.decay;\r\n\r\n            // 移除死亡粒子\r\n            if (particle.life <= 0) {\r\n                this.particles.splice(i, 1);\r\n                continue;\r\n            }\r\n\r\n            // 绘制粒子\r\n            this.drawParticle(particle);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 绘制单个粒子\r\n     */\r\n    private drawParticle(particle: Particle) {\r\n        if (!this.graphics) return;\r\n\r\n        const color = this.hexToColor(particle.color, particle.life);\r\n        this.graphics.fillColor = color;\r\n        this.graphics.circle(particle.x, particle.y, particle.size);\r\n        this.graphics.fill();\r\n    }\r\n\r\n    /**\r\n     * 将十六进制颜色转换为 Color 对象\r\n     */\r\n    private hexToColor(hex: string, alpha: number = 1): Color {\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        if (result) {\r\n            return new Color(\r\n                parseInt(result[1], 16),\r\n                parseInt(result[2], 16),\r\n                parseInt(result[3], 16),\r\n                Math.floor(alpha * 255)\r\n            );\r\n        }\r\n        return new Color(255, 255, 255, Math.floor(alpha * 255));\r\n    }\r\n\r\n    /**\r\n     * 清除所有特效\r\n     */\r\n    public clear() {\r\n        this.particles = [];\r\n        if (this.graphics) {\r\n            this.graphics.clear();\r\n        }\r\n    }\r\n}\r\n\r\n"]}