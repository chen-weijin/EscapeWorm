{"version":3,"sources":["file:///G:/escapeworm/NewProject/assets/scripts/managers/AudioManager.ts"],"names":["_decorator","Component","AudioSource","AudioClip","resources","Logger","ccclass","property","AudioManager","soundEnabled","musicEnabled","sounds","Map","onLoad","bgmSource","addComponent","loop","volume","sfxSource","init","settings","playBackgroundMusic","clipPath","load","err","clip","error","play","stopBackgroundMusic","stop","pauseBackgroundMusic","pause","resumeBackgroundMusic","playSound","type","audioPath","getDefaultSoundPath","cachedClip","get","playOneShot","set","setSoundEnabled","enabled","setMusicEnabled","onDestroy","clear"],"mappings":"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","sourcesContent":["/**\r\n * 音频管理器\r\n */\r\nimport { _decorator, Component, AudioSource, AudioClip, resources } from 'cc';\r\nimport { Logger } from '../utils/Logger';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AudioManager')\r\nexport class AudioManager extends Component {\r\n    @property(AudioSource)\r\n    public bgmSource: AudioSource | null = null;\r\n\r\n    @property(AudioSource)\r\n    public sfxSource: AudioSource | null = null;\r\n\r\n    private soundEnabled: boolean = true;\r\n    private musicEnabled: boolean = true;\r\n    private sounds: Map<string, AudioClip> = new Map();\r\n\r\n    protected onLoad() {\r\n        // 创建音频源组件\r\n        if (!this.bgmSource) {\r\n            this.bgmSource = this.addComponent(AudioSource);\r\n            if (this.bgmSource) {\r\n                this.bgmSource.loop = true;\r\n                this.bgmSource.volume = 0.5;\r\n            }\r\n        }\r\n        if (!this.sfxSource) {\r\n            this.sfxSource = this.addComponent(AudioSource);\r\n            if (this.sfxSource) {\r\n                this.sfxSource.loop = false;\r\n                this.sfxSource.volume = 0.7;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 初始化音频管理器\r\n     */\r\n    public init(settings: { musicEnabled: boolean; soundEnabled: boolean }) {\r\n        this.soundEnabled = settings.soundEnabled !== false;\r\n        this.musicEnabled = settings.musicEnabled !== false;\r\n    }\r\n\r\n    /**\r\n     * 播放背景音乐\r\n     */\r\n    public playBackgroundMusic(clipPath: string) {\r\n        if (!this.musicEnabled || !this.bgmSource) {\r\n            return;\r\n        }\r\n\r\n        resources.load(clipPath, AudioClip, (err, clip) => {\r\n            if (err) {\r\n                Logger.error('播放背景音乐失败:', err);\r\n                return;\r\n            }\r\n            if (this.bgmSource) {\r\n                this.bgmSource.clip = clip;\r\n                this.bgmSource.play();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 停止背景音乐\r\n     */\r\n    public stopBackgroundMusic() {\r\n        if (this.bgmSource) {\r\n            this.bgmSource.stop();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 暂停背景音乐\r\n     */\r\n    public pauseBackgroundMusic() {\r\n        if (this.bgmSource) {\r\n            this.bgmSource.pause();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 恢复背景音乐\r\n     */\r\n    public resumeBackgroundMusic() {\r\n        if (this.bgmSource && this.musicEnabled) {\r\n            this.bgmSource.play();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 播放音效\r\n     */\r\n    public playSound(type: string, clipPath: string | null = null) {\r\n        if (!this.soundEnabled || !this.sfxSource) {\r\n            return;\r\n        }\r\n\r\n        const audioPath = clipPath || this.getDefaultSoundPath(type);\r\n        if (!audioPath) {\r\n            return;\r\n        }\r\n\r\n        // 检查缓存\r\n        const cachedClip = this.sounds.get(audioPath);\r\n        if (cachedClip) {\r\n            this.sfxSource.playOneShot(cachedClip);\r\n            return;\r\n        }\r\n\r\n        // 加载并播放\r\n        resources.load(audioPath, AudioClip, (err, clip) => {\r\n            if (err) {\r\n                // 静默处理错误\r\n                return;\r\n            }\r\n            this.sounds.set(audioPath, clip);\r\n            if (this.sfxSource) {\r\n                this.sfxSource.playOneShot(clip);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取默认音效路径\r\n     */\r\n    private getDefaultSoundPath(type: string): string | null {\r\n        // 暂时返回 null，后续可以添加音效文件\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 设置音效开关\r\n     */\r\n    public setSoundEnabled(enabled: boolean) {\r\n        this.soundEnabled = enabled;\r\n    }\r\n\r\n    /**\r\n     * 设置背景音乐开关\r\n     */\r\n    public setMusicEnabled(enabled: boolean) {\r\n        this.musicEnabled = enabled;\r\n        if (!enabled) {\r\n            this.stopBackgroundMusic();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 销毁所有音频资源\r\n     */\r\n    protected onDestroy() {\r\n        this.stopBackgroundMusic();\r\n        this.sounds.clear();\r\n    }\r\n}\r\n\r\n"]}