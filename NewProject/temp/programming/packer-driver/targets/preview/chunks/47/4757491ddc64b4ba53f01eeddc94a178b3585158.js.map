{"version":3,"sources":["file:///G:/escapeworm/NewProject/assets/scripts/ui/GameSceneController.ts"],"names":["_decorator","Component","Node","Label","Color","director","Graphics","Vec3","tween","Slider","GameController","StorageManager","ResultController","Logger","ccclass","property","GameSceneController","gameController","storageManager","currentLevelId","lastZoomProgress","onLoad","addComponent","init","getCurrentLevel","resultPanel","active","setupButtons","setupZoomSlider","initGameController","gameArea","error","controllerNode","parent","node","levelLabel","heartNodes","gameSceneController","initLevel","updateLevelLabel","showError","settingsButton","on","EventType","TOUCH_END","onSettingsClick","menuButton","onMenuClick","restartButton","onRestartClick","nextButton","onNextClick","zoomSlider","progress","updateZoomLabel","update","dt","onZoomSliderChange","zoomScale","setZoomScale","zoomLabel","undefined","string","Math","round","log","loadScene","restartLevel","hideResult","nextLevel","showResult","isVictory","levelId","resultController","getComponent","warn","setScale","to","scale","easing","start","call","message","updateHearts","failCount","i","length","graphics","clear","fillColor","circle","fill"],"mappings":"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","sourcesContent":["/**\r\n * 游戏场景控制器\r\n * 用于管理 GameScene 中的 UI 和游戏逻辑初始化\r\n */\r\nimport { _decorator, Component, Node, Label, Sprite, Color, director, Button, \r\n    Graphics, UITransform, Vec3, tween, Slider } from 'cc';\r\nimport { GameController } from '../GameController';\r\nimport { StorageManager } from '../managers/StorageManager';\r\nimport { ResultController } from './ResultController';\r\nimport { Logger } from '../utils/Logger';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameSceneController')\r\nexport class GameSceneController extends Component {\r\n    @property(Node)\r\n    public gameArea: Node | null = null;\r\n\r\n    @property(Label)\r\n    public levelLabel: Label | null = null;\r\n\r\n    @property([Node])\r\n    public heartNodes: Node[] = [];\r\n\r\n    @property(Node)\r\n    public settingsButton: Node | null = null;\r\n\r\n    @property(Node)\r\n    public menuButton: Node | null = null;\r\n\r\n    @property(Node)\r\n    public restartButton: Node | null = null;\r\n\r\n    @property(Node)\r\n    public resultPanel: Node | null = null;\r\n\r\n    @property(Label)\r\n    public resultLabel: Label | null = null;\r\n\r\n    @property(Node)\r\n    public nextButton: Node | null = null;\r\n\r\n    @property(Slider)\r\n    public zoomSlider: Slider | null = null;\r\n\r\n    @property(Label)\r\n    public zoomLabel: Label | null = null;\r\n\r\n    private gameController: GameController | null = null;\r\n    private storageManager: StorageManager | null = null;\r\n    private currentLevelId: number = 1;\r\n    private lastZoomProgress: number = -1; // 记录上次的滑块值\r\n\r\n    protected onLoad() {\r\n        // 初始化存储管理器获取当前关卡\r\n        this.storageManager = this.addComponent(StorageManager);\r\n        this.storageManager.init();\r\n        this.currentLevelId = this.storageManager.getCurrentLevel();\r\n\r\n        // 隐藏结果面板\r\n        if (this.resultPanel) {\r\n            this.resultPanel.active = false;\r\n        }\r\n\r\n        // 设置按钮事件\r\n        this.setupButtons();\r\n\r\n        // 设置缩放滑块\r\n        this.setupZoomSlider();\r\n\r\n        // 初始化游戏控制器\r\n        this.initGameController();\r\n    }\r\n\r\n    /**\r\n     * 初始化游戏控制器\r\n     */\r\n    private async initGameController() {\r\n        if (!this.gameArea) {\r\n            Logger.error('游戏区域节点未设置');\r\n            return;\r\n        }\r\n\r\n        // 创建游戏控制器节点\r\n        const controllerNode = new Node('GameController');\r\n        controllerNode.parent = this.node;\r\n        this.gameController = controllerNode.addComponent(GameController);\r\n\r\n        // 设置游戏控制器的属性\r\n        this.gameController.gameArea = this.gameArea;\r\n        this.gameController.levelLabel = this.levelLabel;\r\n        this.gameController.heartNodes = this.heartNodes;\r\n        // 设置 GameSceneController 的引用，以便 GameController 可以调用 showResult\r\n        this.gameController.gameSceneController = this.node;\r\n\r\n        // 初始化关卡\r\n        try {\r\n            await this.gameController.initLevel(this.currentLevelId);\r\n            this.updateLevelLabel();\r\n        } catch (error) {\r\n            Logger.error('初始化关卡失败:', error);\r\n            this.showError('加载关卡失败');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置按钮事件\r\n     */\r\n    private setupButtons() {\r\n        if (this.settingsButton) {\r\n            this.settingsButton.on(Node.EventType.TOUCH_END, this.onSettingsClick, this);\r\n        }\r\n        if (this.menuButton) {\r\n            this.menuButton.on(Node.EventType.TOUCH_END, this.onMenuClick, this);\r\n        }\r\n        if (this.restartButton) {\r\n            this.restartButton.on(Node.EventType.TOUCH_END, this.onRestartClick, this);\r\n        }\r\n        if (this.nextButton) {\r\n            this.nextButton.on(Node.EventType.TOUCH_END, this.onNextClick, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置缩放滑块\r\n     */\r\n    private setupZoomSlider() {\r\n        if (this.zoomSlider) {\r\n            // 设置初始值（1.0 = 100%）\r\n            this.zoomSlider.progress = 0.5; // 默认50%，对应缩放比例0.5到1.5之间\r\n            this.lastZoomProgress = this.zoomSlider.progress;\r\n            \r\n            // 使用 update 方法定期检查滑块值变化\r\n            // 这样更可靠，不依赖特定的事件系统\r\n            \r\n            // 更新标签显示\r\n            this.updateZoomLabel();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新方法，检查滑块值变化\r\n     */\r\n    protected update(dt: number) {\r\n        if (this.zoomSlider && this.lastZoomProgress !== this.zoomSlider.progress) {\r\n            this.lastZoomProgress = this.zoomSlider.progress;\r\n            this.onZoomSliderChange();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 缩放滑块值变化回调\r\n     */\r\n    private onZoomSliderChange() {\r\n        if (!this.zoomSlider) return;\r\n        \r\n        // 将滑块进度值（0-1）转换为缩放比例（0.5-1.5）\r\n        const zoomScale = 0.5 + this.zoomSlider.progress * 1.0; // 范围：0.5 到 1.5\r\n        \r\n        // 应用缩放\r\n        if (this.gameController) {\r\n            this.gameController.setZoomScale(zoomScale);\r\n        }\r\n        \r\n        // 更新标签显示\r\n        this.updateZoomLabel(zoomScale);\r\n    }\r\n\r\n    /**\r\n     * 更新缩放标签显示\r\n     */\r\n    private updateZoomLabel(zoomScale?: number) {\r\n        if (this.zoomLabel && this.zoomSlider) {\r\n            if (zoomScale === undefined) {\r\n                zoomScale = 0.5 + this.zoomSlider.progress * 1.0;\r\n            }\r\n            this.zoomLabel.string = `${Math.round(zoomScale * 100)}%`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新关卡标签\r\n     */\r\n    private updateLevelLabel() {\r\n        if (this.levelLabel) {\r\n            this.levelLabel.string = `关卡 ${this.currentLevelId}`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置按钮点击\r\n     */\r\n    private onSettingsClick() {\r\n        Logger.log('打开设置');\r\n        // TODO: 实现设置面板\r\n    }\r\n\r\n    /**\r\n     * 返回菜单按钮点击\r\n     */\r\n    private onMenuClick() {\r\n        director.loadScene('LaunchScene');\r\n    }\r\n\r\n    /**\r\n     * 重新开始按钮点击\r\n     */\r\n    private onRestartClick() {\r\n        this.gameController?.restartLevel();\r\n    }\r\n\r\n    /**\r\n     * 重新开始关卡（供 ResultController 调用）\r\n     */\r\n    public restartLevel() {\r\n        this.hideResult();\r\n        this.gameController?.restartLevel();\r\n    }\r\n\r\n    /**\r\n     * 下一关按钮点击\r\n     */\r\n    private onNextClick() {\r\n        this.gameController?.nextLevel();\r\n    }\r\n\r\n    /**\r\n     * 显示结果弹窗\r\n     */\r\n    public showResult(isVictory: boolean, levelId: number) {\r\n        if (!this.resultPanel) {\r\n            Logger.error('结果面板未设置');\r\n            return;\r\n        }\r\n\r\n        // 获取 ResultController 组件\r\n        let resultController = this.resultPanel.getComponent(ResultController);\r\n        if (!resultController) {\r\n            Logger.warn('结果面板上没有 ResultController 组件，尝试添加');\r\n            resultController = this.resultPanel.addComponent(ResultController);\r\n        }\r\n\r\n        // 初始化结果控制器\r\n        resultController.init(isVictory, levelId);\r\n\r\n        // 显示弹窗（带动画效果）\r\n        this.resultPanel.active = true;\r\n        \r\n        // 设置初始缩放为0，然后动画到1\r\n        this.resultPanel.setScale(0, 0, 1);\r\n        tween(this.resultPanel)\r\n            .to(0.3, { scale: new Vec3(1, 1, 1) }, { easing: 'backOut' })\r\n            .start();\r\n    }\r\n\r\n    /**\r\n     * 隐藏结果弹窗\r\n     */\r\n    public hideResult() {\r\n        if (!this.resultPanel) {\r\n            return;\r\n        }\r\n\r\n        // 动画隐藏\r\n        tween(this.resultPanel)\r\n            .to(0.2, { scale: new Vec3(0, 0, 1) }, { easing: 'backIn' })\r\n            .call(() => {\r\n                this.resultPanel!.active = false;\r\n            })\r\n            .start();\r\n    }\r\n\r\n    /**\r\n     * 显示错误信息\r\n     */\r\n    private showError(message: string) {\r\n        Logger.error(message);\r\n        // TODO: 显示错误提示 UI\r\n    }\r\n\r\n    /**\r\n     * 更新红心显示\r\n     */\r\n    public updateHearts(failCount: number) {\r\n        for (let i = 0; i < this.heartNodes.length; i++) {\r\n            if (this.heartNodes[i]) {\r\n                const graphics = this.heartNodes[i].getComponent(Graphics);\r\n                if (graphics) {\r\n                    graphics.clear();\r\n                    graphics.fillColor = i < failCount ? new Color(244, 67, 54, 255) : new Color(200, 200, 200, 255);\r\n                    graphics.circle(0, 0, 20);\r\n                    graphics.fill();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n"]}