{"version":3,"sources":["file:///G:/escapeworm/NewProject/assets/scripts/entities/Worm.ts"],"names":["_decorator","Component","Vec2","ccclass","property","Worm","segments","originalSegments","previousSegments","isEscaped","isHighlighted","isEscaping","isAnimating","visibleSegmentCount","animationProgress","animationDuration","animationStartTime","segmentNodes","init","config","id","color","map","s","x","y","direction","includes","length","first","second","dx","dy","bodyDirection","oppositeDirection","getHeadPosition","getBodySegments","slice","getAllSegments","getInterpolatedSegments","progress","interpolated","i","prevSeg","currSeg","push","startMoveAnimation","newHeadPosition","duration","Promise","resolve","newSegments","Date","now","setTimeout","completeAnimation","updateAnimation","currentTime","elapsed","Math","min","moveTo","reset","setVisibleSegmentCount","count","max","getVisibleSegments","setHighlighted","highlighted","markEscaped","hasEscaped","getLength","getConfig"],"mappings":"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","sourcesContent":["/**\r\n * 蠕虫实体类\r\n */\r\nimport { _decorator, Component, Node, Vec2, Vec3, Sprite, SpriteFrame, Color, tween, UITransform } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface WormConfig {\r\n    id: number;\r\n    segments: { x: number; y: number }[];\r\n    direction: string;\r\n    color: string;\r\n}\r\n\r\n@ccclass('Worm')\r\nexport class Worm extends Component {\r\n    @property\r\n    public id: number = 0;\r\n\r\n    @property\r\n    public color: string = '#FF5733';\r\n\r\n    @property\r\n    public direction: string = 'right';\r\n\r\n    // 身体段坐标数组\r\n    public segments: Vec2[] = [];\r\n    public originalSegments: Vec2[] = [];\r\n    public previousSegments: Vec2[] = [];\r\n\r\n    // 状态\r\n    public isEscaped: boolean = false;\r\n    public isHighlighted: boolean = false;\r\n    public isEscaping: boolean = false;\r\n    public isAnimating: boolean = false;\r\n\r\n    // 显示相关\r\n    public visibleSegmentCount: number = 0;\r\n\r\n    // 动画相关\r\n    public animationProgress: number = 1.0;\r\n    public animationDuration: number = 10;\r\n    public animationStartTime: number = 0;\r\n\r\n    // 节点引用\r\n    private segmentNodes: Node[] = [];\r\n\r\n    /**\r\n     * 初始化蠕虫\r\n     */\r\n    public init(config: WormConfig) {\r\n        this.id = config.id;\r\n        this.color = config.color;\r\n\r\n        // 深拷贝原始位置\r\n        this.originalSegments = config.segments.map(s => new Vec2(s.x, s.y));\r\n        this.segments = config.segments.map(s => new Vec2(s.x, s.y));\r\n        this.previousSegments = config.segments.map(s => new Vec2(s.x, s.y));\r\n\r\n        // 计算方向\r\n        if (config.direction && ['up', 'down', 'left', 'right'].includes(config.direction)) {\r\n            this.direction = config.direction;\r\n        } else if (this.segments.length >= 2) {\r\n            const first = this.segments[0];\r\n            const second = this.segments[1];\r\n            const dx = second.x - first.x;\r\n            const dy = second.y - first.y;\r\n\r\n            let bodyDirection: string | null = null;\r\n            if (dx > 0) bodyDirection = 'right';\r\n            else if (dx < 0) bodyDirection = 'left';\r\n            else if (dy > 0) bodyDirection = 'down';\r\n            else if (dy < 0) bodyDirection = 'up';\r\n\r\n            const oppositeDirection: { [key: string]: string } = {\r\n                'right': 'left',\r\n                'left': 'right',\r\n                'up': 'down',\r\n                'down': 'up'\r\n            };\r\n\r\n            this.direction = bodyDirection ? oppositeDirection[bodyDirection] : 'right';\r\n        }\r\n\r\n        this.visibleSegmentCount = this.segments.length;\r\n    }\r\n\r\n    /**\r\n     * 获取头部位置\r\n     */\r\n    public getHeadPosition(): Vec2 {\r\n        return this.segments[0];\r\n    }\r\n\r\n    /**\r\n     * 获取身体段位置（不包括头部）\r\n     */\r\n    public getBodySegments(): Vec2[] {\r\n        return this.segments.slice(1);\r\n    }\r\n\r\n    /**\r\n     * 获取所有段位置\r\n     */\r\n    public getAllSegments(): Vec2[] {\r\n        return this.segments;\r\n    }\r\n\r\n    /**\r\n     * 获取插值后的段位置（用于平滑渲染）\r\n     */\r\n    public getInterpolatedSegments(progress: number | null = null): Vec2[] {\r\n        if (progress === null) {\r\n            progress = this.animationProgress;\r\n        }\r\n\r\n        if (progress >= 1.0 || !this.isAnimating) {\r\n            return this.segments;\r\n        }\r\n\r\n        const interpolated: Vec2[] = [];\r\n        for (let i = 0; i < this.segments.length; i++) {\r\n            const prevSeg = this.previousSegments[i] || this.segments[i];\r\n            const currSeg = this.segments[i];\r\n\r\n            interpolated.push(new Vec2(\r\n                prevSeg.x + (currSeg.x - prevSeg.x) * progress,\r\n                prevSeg.y + (currSeg.y - prevSeg.y) * progress\r\n            ));\r\n        }\r\n\r\n        return interpolated;\r\n    }\r\n\r\n    /**\r\n     * 开始移动动画\r\n     */\r\n    public startMoveAnimation(newHeadPosition: Vec2, duration: number = 40): Promise<void> {\r\n        return new Promise((resolve) => {\r\n            if (this.isEscaped) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            // 保存当前位置作为动画起始位置\r\n            this.previousSegments = this.segments.map(s => new Vec2(s.x, s.y));\r\n\r\n            // 新头部在开头\r\n            const newSegments: Vec2[] = [newHeadPosition];\r\n\r\n            // 身体段跟随\r\n            for (let i = 0; i < this.segments.length - 1; i++) {\r\n                newSegments.push(new Vec2(this.segments[i].x, this.segments[i].y));\r\n            }\r\n\r\n            this.segments = newSegments;\r\n\r\n            // 开始动画\r\n            this.animationProgress = 0;\r\n            this.isAnimating = true;\r\n            this.animationDuration = duration;\r\n            this.animationStartTime = Date.now();\r\n\r\n            // 使用 setTimeout 模拟动画完成\r\n            setTimeout(() => {\r\n                this.completeAnimation();\r\n                resolve();\r\n            }, duration);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 更新动画进度\r\n     */\r\n    public updateAnimation(currentTime: number): boolean {\r\n        if (!this.isAnimating) {\r\n            return true;\r\n        }\r\n\r\n        const elapsed = currentTime - this.animationStartTime;\r\n        this.animationProgress = Math.min(elapsed / this.animationDuration, 1.0);\r\n\r\n        if (this.animationProgress >= 1.0) {\r\n            this.isAnimating = false;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 立即完成动画\r\n     */\r\n    public completeAnimation() {\r\n        this.animationProgress = 1.0;\r\n        this.isAnimating = false;\r\n        this.previousSegments = this.segments.map(s => new Vec2(s.x, s.y));\r\n    }\r\n\r\n    /**\r\n     * 移动蠕虫到新位置（立即移动，不使用动画）\r\n     */\r\n    public moveTo(newHeadPosition: Vec2) {\r\n        if (this.isEscaped) {\r\n            return;\r\n        }\r\n\r\n        const newSegments: Vec2[] = [newHeadPosition];\r\n        for (let i = 0; i < this.segments.length - 1; i++) {\r\n            newSegments.push(new Vec2(this.segments[i].x, this.segments[i].y));\r\n        }\r\n\r\n        this.segments = newSegments;\r\n        this.previousSegments = this.segments.map(s => new Vec2(s.x, s.y));\r\n        this.isAnimating = false;\r\n        this.animationProgress = 1.0;\r\n    }\r\n\r\n    /**\r\n     * 复位到原始位置\r\n     */\r\n    public reset() {\r\n        this.segments = this.originalSegments.map(s => new Vec2(s.x, s.y));\r\n        this.previousSegments = this.originalSegments.map(s => new Vec2(s.x, s.y));\r\n        this.isEscaped = false;\r\n        this.isHighlighted = false;\r\n        this.isAnimating = false;\r\n        this.isEscaping = false;\r\n        this.animationProgress = 1.0;\r\n        this.visibleSegmentCount = this.segments.length;\r\n    }\r\n\r\n    /**\r\n     * 设置可见段数量\r\n     */\r\n    public setVisibleSegmentCount(count: number) {\r\n        this.visibleSegmentCount = Math.max(0, Math.min(count, this.segments.length));\r\n    }\r\n\r\n    /**\r\n     * 获取可见的段\r\n     */\r\n    public getVisibleSegments(): Vec2[] {\r\n        if (this.visibleSegmentCount >= this.segments.length) {\r\n            return this.segments;\r\n        }\r\n        return this.segments.slice(-this.visibleSegmentCount);\r\n    }\r\n\r\n    /**\r\n     * 设置高亮状态\r\n     */\r\n    public setHighlighted(highlighted: boolean) {\r\n        this.isHighlighted = highlighted;\r\n    }\r\n\r\n    /**\r\n     * 标记为已逃脱\r\n     */\r\n    public markEscaped() {\r\n        this.isEscaped = true;\r\n    }\r\n\r\n    /**\r\n     * 检查蠕虫是否已逃脱\r\n     */\r\n    public hasEscaped(): boolean {\r\n        return this.isEscaped;\r\n    }\r\n\r\n    /**\r\n     * 获取蠕虫长度\r\n     */\r\n    public getLength(): number {\r\n        return this.segments.length;\r\n    }\r\n\r\n    /**\r\n     * 获取蠕虫配置\r\n     */\r\n    public getConfig(): WormConfig {\r\n        return {\r\n            id: this.id,\r\n            segments: this.segments.map(s => ({ x: s.x, y: s.y })),\r\n            direction: this.direction,\r\n            color: this.color\r\n        };\r\n    }\r\n}\r\n\r\n"]}