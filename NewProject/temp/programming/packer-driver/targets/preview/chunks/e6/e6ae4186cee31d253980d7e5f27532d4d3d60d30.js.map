{"version":3,"sources":["file:///G:/escapeworm/NewProject/assets/scripts/ui/ResultController.ts"],"names":["_decorator","Component","Node","Label","Color","director","UITransform","Graphics","Input","StorageManager","AudioManager","ccclass","property","ResultController","storageManager","audioManager","isVictory","levelId","onLoad","addComponent","init","getSettings","getCurrentLevel","isLevelCompleted","setupUI","setupButtons","backgroundNode","graphics","getComponent","transform","fillColor","rect","width","height","fill","resultLabel","string","color","levelLabel","nextButton","active","on","EventType","TOUCH_END","onNextClick","replayButton","onReplayClick","menuButton","onMenuClick","playSound","nextLevel","isLevelUnlocked","setCurrentLevel","loadScene"],"mappings":"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","sourcesContent":["/**\r\n * 结果场景控制器\r\n */\r\nimport { _decorator, Component, Node, Label, Sprite, Color, director, UITransform, \r\n    Graphics, EventTouch, Vec3, Button, input, Input } from 'cc';\r\nimport { StorageManager } from '../managers/StorageManager';\r\nimport { AudioManager } from '../managers/AudioManager';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ResultController')\r\nexport class ResultController extends Component {\r\n    @property(Label)\r\n    public resultLabel: Label | null = null;\r\n\r\n    @property(Label)\r\n    public levelLabel: Label | null = null;\r\n\r\n    @property(Node)\r\n    public nextButton: Node | null = null;\r\n\r\n    @property(Node)\r\n    public replayButton: Node | null = null;\r\n\r\n    @property(Node)\r\n    public menuButton: Node | null = null;\r\n\r\n    @property(Node)\r\n    public backgroundNode: Node | null = null;\r\n\r\n    private storageManager: StorageManager | null = null;\r\n    private audioManager: AudioManager | null = null;\r\n    private isVictory: boolean = false;\r\n    private levelId: number = 1;\r\n\r\n    protected onLoad() {\r\n        this.storageManager = this.addComponent(StorageManager);\r\n        this.audioManager = this.addComponent(AudioManager);\r\n\r\n        this.storageManager.init();\r\n        this.audioManager.init(this.storageManager.getSettings());\r\n\r\n        // 从存储中获取当前关卡和结果\r\n        this.levelId = this.storageManager.getCurrentLevel();\r\n        // 结果应该通过某种方式传递，这里简单判断关卡是否完成\r\n        this.isVictory = this.storageManager.isLevelCompleted(this.levelId);\r\n\r\n        this.setupUI();\r\n        this.setupButtons();\r\n    }\r\n\r\n    /**\r\n     * 设置 UI\r\n     */\r\n    private setupUI() {\r\n        // 设置背景颜色\r\n        if (this.backgroundNode) {\r\n            const graphics = this.backgroundNode.getComponent(Graphics) || this.backgroundNode.addComponent(Graphics);\r\n            const transform = this.backgroundNode.getComponent(UITransform);\r\n            if (transform) {\r\n                graphics.fillColor = this.isVictory ? new Color(232, 245, 233, 255) : new Color(255, 235, 238, 255);\r\n                graphics.rect(-transform.width / 2, -transform.height / 2, transform.width, transform.height);\r\n                graphics.fill();\r\n            }\r\n        }\r\n\r\n        // 设置结果文字\r\n        if (this.resultLabel) {\r\n            this.resultLabel.string = this.isVictory ? '胜利！' : '失败';\r\n            this.resultLabel.color = this.isVictory ? new Color(76, 175, 80, 255) : new Color(244, 67, 54, 255);\r\n        }\r\n\r\n        // 设置关卡信息\r\n        if (this.levelLabel) {\r\n            this.levelLabel.string = `关卡 ${this.levelId}`;\r\n        }\r\n\r\n        // 根据结果显示/隐藏下一关按钮\r\n        if (this.nextButton) {\r\n            this.nextButton.active = this.isVictory;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置按钮事件\r\n     */\r\n    private setupButtons() {\r\n        if (this.nextButton) {\r\n            this.nextButton.on(Input.EventType.TOUCH_END, this.onNextClick, this);\r\n        }\r\n        if (this.replayButton) {\r\n            this.replayButton.on(Input.EventType.TOUCH_END, this.onReplayClick, this);\r\n        }\r\n        if (this.menuButton) {\r\n            this.menuButton.on(Input.EventType.TOUCH_END, this.onMenuClick, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 下一关按钮点击\r\n     */\r\n    private onNextClick() {\r\n        this.audioManager?.playSound('click');\r\n        const nextLevel = this.levelId + 1;\r\n        if (this.storageManager?.isLevelUnlocked(nextLevel)) {\r\n            this.storageManager.setCurrentLevel(nextLevel);\r\n            director.loadScene('GameScene');\r\n        } else {\r\n            director.loadScene('LaunchScene');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 重玩按钮点击\r\n     */\r\n    private onReplayClick() {\r\n        this.audioManager?.playSound('click');\r\n        director.loadScene('GameScene');\r\n    }\r\n\r\n    /**\r\n     * 返回菜单按钮点击\r\n     */\r\n    private onMenuClick() {\r\n        this.audioManager?.playSound('click');\r\n        director.loadScene('LaunchScene');\r\n    }\r\n\r\n    /**\r\n     * 初始化（用于从其他场景传递数据）\r\n     */\r\n    public init(isVictory: boolean, levelId: number) {\r\n        this.isVictory = isVictory;\r\n        this.levelId = levelId;\r\n        this.setupUI();\r\n    }\r\n}\r\n\r\n"]}