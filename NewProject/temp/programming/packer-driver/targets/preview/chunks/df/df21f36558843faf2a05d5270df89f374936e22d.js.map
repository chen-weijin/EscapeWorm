{"version":3,"sources":["file:///G:/escapeworm/NewProject/assets/scripts/managers/StorageManager.ts"],"names":["_decorator","Component","sys","ccclass","property","StorageManager","UNLOCKED_LEVELS","COMPLETED_LEVELS","CURRENT_LEVEL","SETTINGS","init","unlocked","getUnlockedLevels","length","setUnlockedLevels","data","localStorage","getItem","JSON","parse","e","console","error","levels","setItem","stringify","unlockLevel","levelId","includes","push","isLevelUnlocked","getCompletedLevels","setCompletedLevels","completeLevel","completed","isLevelCompleted","getCurrentLevel","parseInt","setCurrentLevel","toString","getSettings","musicEnabled","soundEnabled","setSettings","settings"],"mappings":"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","sourcesContent":["/**\r\n * 存储管理器\r\n * 管理本地数据存储\r\n */\r\nimport { _decorator, Component, sys } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('StorageManager')\r\nexport class StorageManager extends Component {\r\n    private readonly UNLOCKED_LEVELS = 'unlockedLevels';\r\n    private readonly COMPLETED_LEVELS = 'completedLevels';\r\n    private readonly CURRENT_LEVEL = 'currentLevel';\r\n    private readonly SETTINGS = 'settings';\r\n\r\n    /**\r\n     * 初始化存储\r\n     */\r\n    public init() {\r\n        // 确保第一关默认解锁\r\n        const unlocked = this.getUnlockedLevels();\r\n        if (unlocked.length === 0) {\r\n            this.setUnlockedLevels([1]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取已解锁关卡列表\r\n     */\r\n    public getUnlockedLevels(): number[] {\r\n        try {\r\n            const data = sys.localStorage.getItem(this.UNLOCKED_LEVELS);\r\n            return data ? JSON.parse(data) : [];\r\n        } catch (e) {\r\n            console.error('读取解锁关卡失败:', e);\r\n            return [1];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置已解锁关卡列表\r\n     */\r\n    public setUnlockedLevels(levels: number[]) {\r\n        try {\r\n            sys.localStorage.setItem(this.UNLOCKED_LEVELS, JSON.stringify(levels));\r\n        } catch (e) {\r\n            console.error('保存解锁关卡失败:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 解锁关卡\r\n     */\r\n    public unlockLevel(levelId: number) {\r\n        const unlocked = this.getUnlockedLevels();\r\n        if (!unlocked.includes(levelId)) {\r\n            unlocked.push(levelId);\r\n            this.setUnlockedLevels(unlocked);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 检查关卡是否已解锁\r\n     */\r\n    public isLevelUnlocked(levelId: number): boolean {\r\n        return this.getUnlockedLevels().includes(levelId);\r\n    }\r\n\r\n    /**\r\n     * 获取已完成关卡列表\r\n     */\r\n    public getCompletedLevels(): number[] {\r\n        try {\r\n            const data = sys.localStorage.getItem(this.COMPLETED_LEVELS);\r\n            return data ? JSON.parse(data) : [];\r\n        } catch (e) {\r\n            console.error('读取完成关卡失败:', e);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置已完成关卡列表\r\n     */\r\n    public setCompletedLevels(levels: number[]) {\r\n        try {\r\n            sys.localStorage.setItem(this.COMPLETED_LEVELS, JSON.stringify(levels));\r\n        } catch (e) {\r\n            console.error('保存完成关卡失败:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 标记关卡为已完成\r\n     */\r\n    public completeLevel(levelId: number) {\r\n        const completed = this.getCompletedLevels();\r\n        if (!completed.includes(levelId)) {\r\n            completed.push(levelId);\r\n            this.setCompletedLevels(completed);\r\n        }\r\n\r\n        // 自动解锁下一关\r\n        this.unlockLevel(levelId + 1);\r\n    }\r\n\r\n    /**\r\n     * 检查关卡是否已完成\r\n     */\r\n    public isLevelCompleted(levelId: number): boolean {\r\n        return this.getCompletedLevels().includes(levelId);\r\n    }\r\n\r\n    /**\r\n     * 获取当前关卡\r\n     */\r\n    public getCurrentLevel(): number {\r\n        try {\r\n            const data = sys.localStorage.getItem(this.CURRENT_LEVEL);\r\n            return data ? parseInt(data) : 1;\r\n        } catch (e) {\r\n            return 1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置当前关卡\r\n     */\r\n    public setCurrentLevel(levelId: number) {\r\n        try {\r\n            sys.localStorage.setItem(this.CURRENT_LEVEL, levelId.toString());\r\n        } catch (e) {\r\n            console.error('保存当前关卡失败:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取游戏设置\r\n     */\r\n    public getSettings(): { musicEnabled: boolean; soundEnabled: boolean } {\r\n        try {\r\n            const data = sys.localStorage.getItem(this.SETTINGS);\r\n            return data ? JSON.parse(data) : {\r\n                musicEnabled: true,\r\n                soundEnabled: true\r\n            };\r\n        } catch (e) {\r\n            return {\r\n                musicEnabled: true,\r\n                soundEnabled: true\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 保存游戏设置\r\n     */\r\n    public setSettings(settings: { musicEnabled: boolean; soundEnabled: boolean }) {\r\n        try {\r\n            sys.localStorage.setItem(this.SETTINGS, JSON.stringify(settings));\r\n        } catch (e) {\r\n            console.error('保存设置失败:', e);\r\n        }\r\n    }\r\n}\r\n\r\n"]}